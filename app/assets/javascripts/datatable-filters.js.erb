/**
 * Filter API
 * Tabla - .filter-table
 *       - rel - Ubicacion del post
 * Filter
 *       - .filter
 * Filter extra
 *       - .extra
 *       - data-name - Nombre del filtro en el post
 * Column
 *       - th
 *       - data-name - Nombre de la columna
 *       -
 *
 */

var datatables_spanisn_language = {
    "sProcessing": "Procesando...",
    "sLengthMenu": "Mostrar _MENU_ registros",
    "sZeroRecords": "No se encontraron resultados",
    "sEmptyTable": "Ningún dato disponible en esta tabla",
    "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
    "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
    "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
    "sInfoPostFix": "",
    "sSearch": "Buscar:",
    "sUrl": "",
    "sInfoThousands": ",",
    "sLoadingRecords": "Cargando...",
    "oPaginate": {
        "sFirst": "Primero",
        "sLast": "Último",
        "sNext": "Siguiente",
        "sPrevious": "Anterior"
    },
    "oAria": {
        "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
        "sSortDescending": ": Activar para ordenar la columna de manera descendente"
    }
};

var datablefilters_ready = function() {

    function dataFill(data) {
        $(".filter-data").each(function(){
            data[$(this).attr("data-name")] = $(this).val();
        });
    }

    var columns = $(".filter-table th").map(function(i) {
        var obj = {};
        var dataName = $(this).attr("data-name");
        var name = dataName ? dataName : i.toString();
        obj.data = name;
        obj.name = name;
    }).toArray();


    var table = $('.filter-table').DataTable({
        processing: true,
        paging: true,
        serverSide: true,
        ajax: {
            url: $(this).attr("rel"),
            type: 'POST',
            data: dataFill
        },
        order: [],
        dom: 'lrtip',
        columns: columns
        <% if I18n.locale == :es %>
        ,language: datatables_spanisn_language
        <% end %>
    });

    $('.reset-filters').click(function(){
        $(".chosen").val('').trigger("chosen:updated");
        $( '.filter').val('');
        table.search('').columns().search('');
        table.draw();
    });

};